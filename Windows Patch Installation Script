#Windows Patch Installation Script,Script need to be adjusted as per your requirement , its just a skeleton 
#--------------------------------------------------------------------------
#Script  : Windows Patch Installation Script.ps1 
#Author  : chandrashekharbhat@rocketmail.com  
#Version : 0.1
#Description : Validate the pactches on the VM and install it.
#--------------------------------------------------------------------------


#Counter declaration and Initialization
$SSU_Count = 0
$Mandatory_Count_KBXXXXXXX =0
$Mandatory_Count_KBXXXXXXY =0
$CU_Count =0

#Get installed hotfixes
$installedKB = (get-hotfix | Select-Object  HotFixID).HotfixID

#Verify the SSU Installed or not

foreach ($SSU in $installedKB ){
 if( $SSU -eq 'KB50193851'){
  #Write-Host "SSU Counter"
  $SSU_Count++
}
}

#SSU Installation
 if ($SSU_Count -ne 1){
 Write-Host "Installing SSU"
 #Download the SU and Install
 }
 else{
  Write-Host "SSU Already Present"
 }
 
#Verify the Mandatory Kbs Installed or not

$Mandatory = {
KB5021234
KB5012170
}

foreach ($Mandatory in $installedKB ){
 if($Mandatory  -eq 'KB5021234' ){
   $Mandatory_Count1++
}
}

foreach ($Mandatory in $installedKB ){
 if($Mandatory  -eq 'KB5012170' ){
   $Mandatory_Count2++
}
}

#installing Mandatory KB1
    if($Mandatory_Count_KBXXXXXXX -ne 1){
    Write-Host "Installing Mandatory"
    #Download the Mandatory KBXXXXXXX and Install
    }
  else{
     Write-Host " Mandatory KBXXXXXXX Already Present"
  }
#installing Mandatory KB2
if($Mandatory_KBXXXXXXY -ne 1){
   Write-Host "Installing Mandatory"
   #Download the Mandatory KBXXXXXXY and Install
    }
  else{
  Write-Host " Mandatory KBXXXXXXY Already Present"
  }
    
#Verify the CU Installtion

foreach ($CU in $installedKB ){
  if( $CU -eq 'KB5019385'){
   #Write-Host "CU Counter"
   $CU_Count++
 }
 }

 #Install the CU
  if ($CU_Count -ne 1){
  #Download the CU and Install
  }
  else{
  Write-Host " CU KB Already Present"
  }
  
