#Windows Patch Installation Script,Script need to be adjusted as per your requirement , its just a skeleton 
#--------------------------------------------------------------------------
#Script  : Windows Patch Installation Script.ps1 
#Author  : chandrashekharbhat@rocketmail.com  
#Version : 0.1
#Description : Validate the pactches on the VM and install it.
#--------------------------------------------------------------------------


#Counter declaration and Initialization
$SSU_Count = 0
$Mandatory_Count_KBXXXXXXX =0
$Mandatory_Count_KBXXXXXXY =0
$CU_Count =0

#Get installed hotfixes
$installedKB = (get-hotfix | Select-Object  HotFixID).HotfixID

#Verify the SSU Installed or not

foreach ($SSU in $installedKB ){
 if( $SSU -eq 'SSU_KB_Number'){
  #Write-Host "SSU Counter"
  $SSU_Count++
}
}

#SSU Installation
 if ($SSU_Count -ne 1){
 Write-Host "Installing SSU"
 #Download the SU and Install
 #Append the Download and installation commands
 }
 else{
  Write-Host "SSU Already Present"
 }
 
#Verify the Mandatory Kbs Installed or not

$Mandatory = {
KBXXXXXXX
KBXXXXXXY
}

foreach ($Mandatory in $installedKB ){
 if($Mandatory  -eq 'KBXXXXXXX' ){
   $Mandatory_Count_KBXXXXXXX++
}
}

foreach ($Mandatory in $installedKB ){
 if($Mandatory  -eq 'KBXXXXXXY' ){
   $Mandatory_Count_KBXXXXXXY++
}
}

#installing Mandatory KBXXXXXXX
    if($Mandatory_Count_KBXXXXXXX -ne 1){
    Write-Host "Installing Mandatory"
    #Download the Mandatory KBXXXXXXX and Install
    #Append the Download and installation commands
    }
  else{
     Write-Host " Mandatory KBXXXXXXX Already Present"
  }
#installing Mandatory KBXXXXXXY
if($Mandatory_KBXXXXXXY -ne 1){
   Write-Host "Installing Mandatory"
   #Download the Mandatory KBXXXXXXY and Install
   #Append the Download and installation commands
    }
  else{
  Write-Host " Mandatory KBXXXXXXY Already Present"
  }
    
#Verify the CU Installtion

foreach ($CU in $installedKB ){
  if( $CU -eq 'CU_KB_Number'){
   #Write-Host "CU Counter"
   $CU_Count++
 }
 }

#Install the CU
  if ($CU_Count -ne 1){
    $SSUInstalled = (get-hotfix -ID SSU_KB_Number -ErrorAction SilentlyContinue).HotfixID 
      if ($SSUInstalled -eq 'SSU_KB_Number'){
          #Download the CU and Install
          Write-Host "Installing CU"
          #Append the Download and installation commands
         }
         else{
  Write-Host "Install SSU First"
  }
  }
  else{
  Write-Host " CU KB Already Present"
  }
 
